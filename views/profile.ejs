<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Profile | FlexBase</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" href="/css/profile.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Cormorant+Garamond:wght@500;600;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <%- include('partials/navbar') %>
        <div class="profile-dashboard-container">
            <!-- Sidebar Section -->
            <aside class="profile-sidebar">
                <div class="profile-pic-username">
                    <img src="<%= user.profileImage || '/images/default-profile.jpg' %>" class="profile-avatar-big"
                        alt="Profile Photo">
                    <div class="profile-username-big">
                        <%= user.username %>
                    </div>
                    <div class="profile-about">
                        <%= user.bio ? user.bio : 'No about me set. Add something cool here!' %>
                    </div>
                </div>
                <nav class="profile-side-nav">
                    <button class="side-nav-btn active" data-tab="followers">
                        <span class="side-nav-icon"><svg width="22" height="22" fill="none" stroke="#727272"
                                stroke-width="2" viewBox="0 0 24 24">
                                <circle cx="12" cy="7" r="4" />
                                <path d="M2 21c0-4.5 5-7 10-7s10 2.5 10 7" />
                            </svg></span>
                        Followers
                    </button>
                    <button class="side-nav-btn" data-tab="following">
                        <span class="side-nav-icon"><svg width="22" height="22" fill="none" stroke="#727272"
                                stroke-width="2" viewBox="0 0 24 24">
                                <circle cx="12" cy="7" r="4" />
                                <path d="M17 21v-2a4 4 0 00-4-4H7a4 4 0 00-4 4v2" />
                            </svg></span>
                        Following
                    </button>
                    <button class="side-nav-btn" data-tab="posts">
                        <span class="side-nav-icon"><svg width="22" height="22" fill="none" stroke="#727272"
                                stroke-width="2" viewBox="0 0 24 24">
                                <rect x="4" y="4" width="16" height="16" rx="3" />
                                <path d="M4 8h16" />
                            </svg></span>
                        Posts
                    </button>
                    <button class="side-nav-btn" data-tab="collections">
                        <span class="side-nav-icon"><svg width="22" height="22" fill="none" stroke="#727272"
                                stroke-width="2" viewBox="0 0 24 24">
                                <path d="M3 6h18M3 12h18M3 18h18" />
                            </svg></span>
                        Collections
                    </button>
                    <button class="side-nav-btn" data-tab="saved">
                        <span class="side-nav-icon"><svg width="22" height="22" fill="none" stroke="#727272"
                                stroke-width="2" viewBox="0 0 24 24">
                                <path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z" />
                            </svg></span>
                        Saved
                    </button>
                </nav>
                <button class="edit-profile-btn">Edit Profile</button>
            </aside>

            <!-- Main Content Area -->
            <section class="profile-main-content">
                <div class="profile-tab-pane active" data-tab="followers">
                    <div class="profile-tab-title">
                        Followers
                        <span class="profile-count">
                            <%= followers ? followers.length : 0 %>
                        </span>
                    </div>
                    <div class="profile-tab-placeholder">
                        [Follower list will appear here]
                    </div>
                </div>
                <div class="profile-tab-pane" data-tab="following">
                    <div class="profile-tab-title">
                        Following
                        <span class="profile-count">
                            <%= following ? following.length : 0 %>
                        </span>
                    </div>
                    <div class="profile-tab-placeholder">
                        [Following list will appear here]
                    </div>
                </div>
                <div class="profile-tab-pane" data-tab="posts">
                    <div class="profile-tab-title">
                        Posts
                        <span class="profile-count">
                            <%= posts ? posts.length : 0 %>
                        </span>
                    </div>
                    <div class="profile-tab-placeholder">
                        [User posts will display here with images and icons]
                    </div>
                </div>
                <div class="profile-tab-pane" data-tab="collections">
                    <div class="profile-tab-title">
                        Collections
                        <span class="profile-count">
                            <%= collections ? collections.length : 0 %>
                        </span>
                        <span class="profile-total-value">
                            $<%= collections.reduce((sum, c)=> sum + (c.marketPrice || 0), 0) %> Total Market Value
                        </span>
                    </div>
                    <% if (collections && collections.length> 0) { %>
                        <div class="collection-grid">
                            <% collections.forEach(function(coll, idx) { %>
                                <div class="collection-card" data-index="<%= idx %>">
                                    <div class="collection-img-wrap">
                                        <img src="<%= coll.images[0] %>" alt="<%= coll.brand %> shoe" />
                                        <% if (coll.images.length> 1) { %>
                                            <span class="multi-icon" title="Multiple Images">&#x1F5BC;</span>
                                            <% } %>
                                    </div>
                                    <div class="collection-brand">
                                        <%= coll.brand %>
                                    </div>
                                    <div class="collection-market-price">$<%= coll.marketPrice %>
                                    </div>
                                </div>
                                <% }) %>
                        </div>
                        <!-- Modal HTML -->
                        <div id="collectionModal" class="collection-modal">
                            <div class="collection-modal-content">
                                <span id="closeModalBtn" class="close-modal">&times;</span>
                                <div class="modal-images">
                                    <button class="arrow arrow-left">&#10094;</button>
                                    <div class="modal-img-slider">
                                        <!-- images injected by JS -->
                                    </div>
                                    <button class="arrow arrow-right">&#10095;</button>
                                    <div class="slider-indicator"></div>
                                    <div class="slider-counter"></div>
                                </div>
                                <div class="modal-meta">
                                    <div class="modal-brand"></div>
                                    <div class="modal-prices"></div>
                                    <div class="modal-date"></div>
                                    <div class="ownership-timeline">
                                        <!-- timeline injected by JS -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <% } else { %>
                            <div class="profile-tab-placeholder">No shoes in your collection yet.</div>
                            <% } %>
                </div>


                <div class="profile-tab-pane" data-tab="saved">
                    <div class="profile-tab-title">Saved</div>
                    <div class="profile-tab-placeholder">[Saved posts and collections will display here]</div>
                </div>
            </section>
        </div>
        <!-- Edit Profile Modal -->
        <div id="editProfileModal" class="modal">
            <div class="modal-content">
                <h2>Edit Profile</h2>
                <form id="editProfileForm" enctype="multipart/form-data">
                    <label for="profilePicture">Profile Picture:</label>
                    <input type="file" id="profilePicture" name="profilePicture" accept="image/*">

                    <label for="bio">Bio:</label>
                    <textarea id="bio" name="bio" rows="4"><%= user.bio || '' %></textarea>

                    <div class="modal-buttons">
                        <button type="button" id="cancelBtn" class="btn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Confirmation Dialog -->
        <div id="confirmCancel" class="modal">
            <div class="modal-content">
                <p>Are you sure you want to cancel your changes?</p>
                <button id="confirmYes" class="btn btn-danger">Yes</button>
                <button id="confirmNo" class="btn">No</button>
            </div>
        </div>

        <!-- Notification Toast -->
        <div id="toast" class="toast"></div>

        <script src="/js/profile.js"></script>
        <script>
            // Pass all collections as a JS variable
            const allCollections = <%- JSON.stringify(collections) %>;
        </script>
</body>

</html>